<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="OwnTracks.org">
        <link rel="canonical" href="http://owntracks.org/features/tls/">
        <link rel="shortcut icon" href="../../favicon.ico">
        

	<title>TLS - OwnTracksDoc</title>

        <link href="../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">OwnTracksDoc</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Intro</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../guide/what/">What it does</a>
                        </li>
                    
                        <li >
                            <a href="../../guide/how/">How it works</a>
                        </li>
                    
                        <li >
                            <a href="../../guide/ui/">User interface</a>
                        </li>
                    
                        <li >
                            <a href="../../guide/scenarios/">Scenarios</a>
                        </li>
                    
                        <li >
                            <a href="../../guide/mqtt/">MQTT</a>
                        </li>
                    
                        <li >
                            <a href="../../guide/topics/">Topics</a>
                        </li>
                    
                        <li >
                            <a href="../../guide/broker/">Broker</a>
                        </li>
                    
                        <li >
                            <a href="../../guide/apps/">Apps</a>
                        </li>
                    
                        <li >
                            <a href="../../guide/clients/">Clients</a>
                        </li>
                    
                        <li >
                            <a href="../../guide/friends/">Friends</a>
                        </li>
                    
                        <li >
                            <a href="../../guide/waypoints/">Waypoints</a>
                        </li>
                    
                        <li >
                            <a href="../../guide/beacons/">iBeacons</a>
                        </li>
                    
                        <li >
                            <a href="../../guide/bridge/">Bridging</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Features <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../hosted/">Hosted</a>
                        </li>
                    
                        <li >
                            <a href="../security/">Security</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">TLS</a>
                        </li>
                    
                        <li >
                            <a href="../location/">Location</a>
                        </li>
                    
                        <li >
                            <a href="../tid/">TID</a>
                        </li>
                    
                        <li >
                            <a href="../friends/">Friends</a>
                        </li>
                    
                        <li >
                            <a href="../card/">Card</a>
                        </li>
                    
                        <li >
                            <a href="../waypoints/">Waypoints</a>
                        </li>
                    
                        <li >
                            <a href="../beacons/">Beacons</a>
                        </li>
                    
                        <li >
                            <a href="../pedometer/">Pedometer</a>
                        </li>
                    
                        <li >
                            <a href="../settings/">Settings</a>
                        </li>
                    
                        <li >
                            <a href="../comparison/">Comparison</a>
                        </li>
                    
                        <li >
                            <a href="../android/">Android</a>
                        </li>
                    
                        <li >
                            <a href="../ios/">iOS</a>
                        </li>
                    
                        <li >
                            <a href="../remoteconfig/">Remoteconfig</a>
                        </li>
                    
                        <li >
                            <a href="../debug/">Debugging</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../tech/json/">JSON</a>
                        </li>
                    
                        <li >
                            <a href="../../tech/program/">Code</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Sundry <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../terminology/">Terminology</a>
                        </li>
                    
                        <li >
                            <a href="../../privacy/">Privacy</a>
                        </li>
                    
                        <li >
                            <a href="../../people/">People</a>
                        </li>
                    
                        <li >
                            <a href="../../ideas/">Ideas</a>
                        </li>
                    
                        <li >
                            <a href="../../faq/">Answers</a>
                        </li>
                    
                        <li >
                            <a href="../../press/">Press</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../security/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../location/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/owntracks">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#configure-tls-on-the-mosquitto-broker">Configure TLS on the Mosquitto broker</a></li>
        
    
        <li class="main "><a href="#configure-the-owntracks-app-to-use-tls">Configure the OwnTracks app to use TLS</a></li>
        
    
        <li class="main "><a href="#android">Android</a></li>
        
    
        <li class="main "><a href="#ios">iOS</a></li>
        
    
        <li class="main "><a href="#manual-configuration-on-android">manual configuration on Android</a></li>
        
    
        <li class="main "><a href="#the-nitty-gritty">The nitty gritty</a></li>
        
            <li><a href="#obtain-a-certificate-and-key">Obtain a certificate and key</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<p>You want data between your mobile device (a.k.a. smartphone) and the MQTT broker you use to be secured from eavesdropping. This is accomplished using <em>TLS</em> (the artist formerly known as <em>SSL</em>). When you configure your broker you will generate what is called a CA certificate which is basically a large amount of bits. (See below for the nitty gritty.)</p>
<p>Configuring TLS (<a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">Transport Layer Security</a>) for OwnTracks involves doing three things:</p>
<ul>
<li>Obtain a TLS certificate/key pair (see below on how to do this) if you don't yet have one</li>
<li>Configure TLS on the MQTT broker</li>
<li>Configuring the app to use TLS</li>
</ul>
<p>You can share the cerficate if you want to (though not many people will want it ...)
It's so public, that it's perfectly OK to send yourself the file by, say, e-mail.</p>
<h3 id="configure-tls-on-the-mosquitto-broker">Configure TLS on the Mosquitto broker</h3>
<p>We'll first show you how to set up TLS on your Mosquitto <a href="../../guide/broker/">broker</a>.
The basic configuration for TLS in <a href="http://mosquitto.org/man/mosquitto-conf-5.html">mosquitto.conf</a> is:</p>
<pre><code>listener 8883
tls_version tlsv1
cafile .............
certfile .............
keyfile .............
</code></pre>

<p>(see also: <a href="http://mosquitto.org/man/mosquitto-tls-7.html">mosquitto-tls</a>.)</p>
<ul>
<li><code>8883</code> is the standard MQTT port for TLS connections. Change it if you need to, but make sure your OwnTracks app is configured to use the same port.</li>
<li><code>tls_version</code> specifies TLSv1 which is currently a requirement for the OwnTracks apps, as their APIs support that TLS version.</li>
<li><code>cafile</code> is the path to the certificate authority file</li>
<li><code>certfile</code> points to your server's certificate in PEM format</li>
<li><code>keyfile</code> points to your server's secret key file (which you <em>never</em> divulge!)</li>
</ul>
<h3 id="configure-the-owntracks-app-to-use-tls">Configure the OwnTracks app to use TLS</h3>
<p>We show you here how to set up your iOS or Android device with that kind of certificate.</p>
<p>In both cases we assume you've got an e-mail in your inbox with the file you've sent yourself. This file has a <code>.crt</code> extension, and in both Android and iOS you can simply launch configuration by clicking on the attachment.</p>
<p>In our example, the CA certificate is called <code>MQTTitude-ca.crt</code>.</p>
<h2 id="android">Android</h2>
<p>Note that by following these instructions on Android you'll be prompted to set a device PIN or pattern to protect the device. If you already have that, just carry on. If you absolutely don't want to do that, you should download the certificate into, say, the Downloads folder, and configure it manually in OwnTracks (see below).</p>
<p>So, here's your e-mail message with said attachment.</p>
<p><img alt="Android" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/android-cert-01-mail.png" /></p>
<p>Now click on the attached file, and you'll get the following dialog where you have to specify a name for the certificate (sigh: the certificate contains a name, but Android wants you to name it anyway). Give it any old name. We've chosen <code>MQTTitude</code>, of course. Then click OK.</p>
<p><img alt="Android" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/android-cert-02-stor.png" /></p>
<p>That's it. You're done, and if you no longer require the certificate file just delete the e-mail, though we recommend you keep it around for a bit.</p>
<p>Note that installing a certificate into Android will, since Kitkat (4.4) bring up a warning when you power up your device. This warning is harmless (even though we consider it quite annoying).</p>
<p><img alt="Android" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/cert-alert.png" /></p>
<h2 id="ios">iOS</h2>
<p>So, here's your e-mail containing the certificate file. Click on it to launch the profile installer. No worries: we're not going to break anything. We're just adding yet another certificate to iOS' certificate store, and you're going to say that you trust that certificate. You ought to trust it: you've just created it yourself!</p>
<p><img alt="iOS" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/ios-cert-01-mail.png" /></p>
<p>You've clicked, and here's the trust store. You see the certificate has a name, but it's not trusted yet. Click on Install.</p>
<p><img alt="iOS" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/ios-cert-02-stor.png" /></p>
<p>Read the text if you must. Just kidding: honestly, it's ok. But do read the text, and then click "Install" on the top right.</p>
<p><img alt="iOS" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/ios-cert-03-stor.png" /></p>
<p>There you go! That's it: the certificate was installed.</p>
<p><img alt="iOS" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/ios-cert-04-stor.png" /></p>
<p>You're done, and if you no longer require the certificate file just delete the e-mail, though we recommend you keep it around for a bit.</p>
<h2 id="manual-configuration-on-android">manual configuration on Android</h2>
<p>From the, say, e-mail you got with the certificate, click "save" on the attached <code>.crt</code> file which is stored on your device's <code>Download</code> folder.</p>
<p>In OwnTracks's settings, select <code>TLS (Custom Certificate)</code></p>
<p><img alt="Android custom" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/android-custom-01.png" /></p>
<p>Now comes the hard part: you have to enter the path to the certificate you downloaded. On my device this is <code>/storage/emulated/0/Download/MQTTitude.crt</code>. Your mileage, etc; </p>
<p><img alt="Android custom" src="https://raw.github.com/wiki/owntracks/owntracks/assets/tls/android-custom-02.png" /></p>
<p>When you click <code>Connect</code>, it will try and use your certificate. Good luck! ;-)</p>
<h2 id="the-nitty-gritty">The nitty gritty</h2>
<p>That CA certificate file we mentioned? The attachment called <code>something.crt</code>?
It looks like this, in fact, in what is called <a href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">PEM</a> format; but you don't really want to know that, but if you do, this is what it looks like:</p>
<pre><code>-----BEGIN CERTIFICATE-----
MIIDGTCCAoKgAwIBAgIJAODXne2yV51zMA0GCSqGSIb3DQEBBQUAMGcxCzAJBgNV
BAYTAkRFMQwwCgYDVQQIEwNOUlcxETAPBgNVBAcTCElyZ2VuZHdvMRYwFAYDVQQK
...
pjGM/XgBs62UhqXnoHrHh/AHIiHieuNFwOhUg0fD/vQ5O6UZkJTWY5LLmEyPN5sS
cPZ5pT/WCvGuIOgNdy1VyWJrrlAjeQlbK+GDcNc=
-----END CERTIFICATE-----
</code></pre>

<p>That's plain text, even though it might be hard to believe. Actually, it's all sorts of magic wrapped into ASCII bytes, but we can look inside that, and we'll give you a sneak peak:</p>
<pre><code>Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            e0:d7:9d:ed:b2:57:9d:73
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=DE, ST=NRW, L=Irgendwo, O=MQTTitude.org/emailAddress=jjolie@example.com
        Validity
            Not Before: Aug 18 10:26:08 2013 GMT
            Not After : Aug 16 10:26:08 2023 GMT
        Subject: C=DE, ST=NRW, L=Irgendwo, O=MQTTitude.org/emailAddress=jjolie@example.com
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
            RSA Public Key: (1024 bit)
                Modulus (1024 bit):
                    00:bd:70:b0:49:d4:17:c9:17:33:4d:74:fc:61:25:
                    ...
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Subject Key Identifier: 
                4C:89:83:F0:33:AD:2B:D7:FD:DE:1D:6D:8D:00:52:C1:1C:75:B1:85
            X509v3 Authority Key Identifier: 
                keyid:4C:89:83:F0:33:AD:2B:D7:FD:DE:1D:6D:8D:00:52:C1:1C:75:B1:85
                DirName:/C=DE/ST=NRW/L=Irgendwo/O=MQTTitude.org/emailAddress=jjolie@example.com
                serial:E0:D7:9D:ED:B2:57:9D:73

            X509v3 Basic Constraints: 
                CA:TRUE
    Signature Algorithm: sha1WithRSAEncryption
        74:12:f8:d0:51:3a:c6:f8:62:75:61:d1:56:2f:bf:e3:64:3c:
        ...
</code></pre>

<p>Better, huh? Well, at least parts of it are now readable. Hope you liked this.</p>
<h3 id="obtain-a-certificate-and-key">Obtain a certificate and key</h3>
<p>The following sections are not an endorsement of a particular Certification Authority, but rather are a few tips on getting you set up with <a href="http://mosquitto.org">Mosquitto</a>.</p>
<p>You can also create your own self-signed certificate. We provide the <a href="https://github.com/binarybucks/mqttitude/tree/master/tools/TLS">generate-CA.sh</a> utility for doing this easily.</p>
<h4 id="startsslcom">startssl.com</h4>
<p>If you have a key-pair issued by <em>startssl.com</em>, you'll be issued a key (in a <code>*.key</code> file), and a certificate (as <code>*.pem</code> or <code>*.crt</code> -- either contains a PEM-encoded certificate).</p>
<p><a href="http://mosquitto.org">Mosquitto</a> will need the certificate chain for <em>startssl.com</em>, which you can find as <a href="http://www.startssl.com/certs/ca-bundle.crt">ca-bundle.crt</a> at <a href="http://www.startssl.com/certs/">www.startssl.com/certs/</a>.</p>
<p>As far as TLS is concerned, you'll therefore set up your <code>mosquitto.conf</code> as follows, specifying corrrect paths to the files.</p>
<pre><code>listener 8883
tls_version tlsv1
cafile ca-bundle.crt
certfile server.crt
keyfile server.key
</code></pre>

<p>Then download the <em>startssl.com</em> CA certificate (<a href="http://www.startssl.com/certs/ca.crt">ca.crt</a>) and install that on your device as described above.</p></div>
        </div>

	<footer class="col-md-12">
		<hr>
		
		<center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
	</footer>


        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>